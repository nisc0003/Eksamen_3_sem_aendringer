---
import MainLayout from "../../layouts/MainLayout.astro";
import Heading from "../../components/Heading.astro";
import Text from "../../components/Text.astro";
import Link from "../../components/Link.astro";
import Card from "../../components/Card.astro";

interface Card {
  mediaType?: string;
  mediaSrc?: string;
  imagesingle?: string;
  image?: string;
  [key: string]: any;
}

function resolveMedia(card: Card) {
  const mediaType = card?.mediaType;
  const mediaSrc = card?.mediaSrc;

  if (mediaType && mediaSrc) return { type: mediaType, src: mediaSrc };
  if (card?.imagesingle) return { type: "image", src: card.imagesingle };
  if (card?.image) return { type: "image", src: card.image };

  return null;
}

// Changed: Added color theme selection based on slug for dynamic singleview styling
// Each slug gets assigned a unique color theme from the available palettes
// Yellow and orange use lighter versions (100) for better contrast with black text
// Purple and green use darker versions (400) for contrast with white text
// This creates visual variety without changing the design
const colorThemeMap: Record<string, { bg: string; accent: string; light: string; textColor: string }> = {
  frivillig: { bg: "var(--color-orange--100)", accent: "var(--color-orange--200)", light: "var(--color-orange--100)", textColor: "text-black" },
  stoettemedlem: { bg: "var(--color-purple--400)", accent: "var(--color-purple--200)", light: "var(--color-purple--100)", textColor: "text-white" },
  samarbejdspartner: { bg: "var(--color-yellow--100)", accent: "var(--color-yellow--200)", light: "var(--color-yellow--100)", textColor: "text-black" },
  "erhvervspartner": { bg: "var(--color-green--400)", accent: "var(--color-green--200)", light: "var(--color-green--100)", textColor: "text-white" },
  "spred-budskabet": { bg: "var(--color-orange--100)", accent: "var(--color-orange--200)", light: "var(--color-orange--100)", textColor: "text-black" },
};

// Data for alle cards
const cards = [
  {
    slug: "frivillig",
    title: "Bliv frivillig",
    image: "/img/frivillig.webp",
    subtitle: "Bliv en del af vores team",
    textfield1:
      "De frivillige er vores vigtigste ressource. Siden 2008 har Stop Spild Af Mad involveret over 500 frivillige fra hele Danmark i vores mange projekter, aktiviteter, events o.lign.",
    textfield2:
      "Vi afholder workshops både for begyndere og øvede kokke, hvor fokus er på kreativitet og Vi er interesseret i at høre fra frivillige over hele landet. Opgaver kan være alt fra at give en hånd ved vores mange events, hjælpe med at videreformilde god overskudsmad til socialt udsatte eller optræde som case i TV, radio, aviser og andre medier.",
    textfield3:
      "Hvis du er interesseret i at blive en del af vores engagerede team af Stop Spild Af Mad frivillige, kan du tilmelde dig via linket nedenfor.",
    id: "frivillig",
    link: "/tilmeldt",
    mediaType: "iframe",
    mediaSrc: "https://www.youtube.com/embed/qW3uiahCmgI?si=GT8Mwa1S7DoDE2Li",
  },
  {
    slug: "stoettemedlem",
    title: "Bliv støttemedlem",
    image: "/img/stoettemedlem.webp",
    imagesingle: "/img/stoettemedlemsingle.svg",
    subtitle: "HVAD INDEBÆRE DET?",
    textfield1:
      "Privatpersoner, erhvervsvirksomheder, kommuner, foreninger, institutioner og organisationer kan blive støttemedlemmer af foreningen Stop Spild Af Mad, og derved aktivt støtte foreningen Stop Spild Af Mads arbejde i mod madspild.",
    textfield2:
      "Det er gratis at blive støttemedlem af foreningen Stop Spild Af Mad.",
    id: "stoettemedlem",
    link: "/tilmeldt",
  },
  {
    slug: "samarbejdspartner",
    title: "Bliv samarbejdspartner",
    image: "/img/samarbejdspartner.webp",
    imagesingle: "/img/samarbejdspartner.webp",
    subtitle: "Bliv vores samarbejdspartner",
    textfield1:
      "Som Danmarks mest toneangivende organisation mod madspild har Stop Spild Af Mad siden 2008 opbygget en bred vifte af tunge danske og internationale samarbejdspartnere, som støtter Stop Spild Af Mads projekter og aktiviteter - bl.a. Landbrug & Fødevarer, Nordisk Råd, EU, FN og mange andre. Sammen er vi endnu stærkere i kampen mod madspild.",
    textfield2:
      "Hvis du er interesseret i at indgå et samarbejde med Stop Spild Af Mad, kan du kontakte os via linket nedenfor.",
    id: "samarbejdspartner",
    link: "/tilmeldt",
    mediaType: "iframe",
    mediaSrc: "https://www.youtube.com/embed/j6thhcW7tg4?si=R8mVVzoS8oIUV6mf",
  },
  {
    slug: "erhvervspartner",
    title: "Bliv erhvervspartner",
    image: "/img/erhvervspartner.webp",
    imagesingle: "/img/erhvervspartner.webp",
    subtitle: "Støt foreningen Stop Spild Af Mad",
    textfield1:
      "Som erhvervspartner hos Stop Spild Af Mad er I med til at støtte foreningens arbejde i kampen mod madspild og bidrage til konkrete projekter og initiativer.",
    textfield2:
      "Erhvervspartnerskaberne er udviklet som en del af et større udviklingsprojekt støttet af Tuborgfondet.",
    textfield3:
      "Hvis I er interesseret i at høre mere om mulighederne for et erhvervspartnerskab, er I meget velkomne kan du kontakte os via telefon eller mail samt via linket nedenfor.",
    list: ["E-mail: info@stopspildafmad.org", "Telefon: +45 40 72 06 01"],
    id: "erhvervspartner",
    link: "/tilmeldt",
  },
  {
    slug: "spred-budskabet",
    title: "Spred budskabet",
    image: "/img/spred_budskab.webp",
    imagesingle: "/img/spred_budskab.webp",
    subtitle: "Bliv ambassadør i kampen mod madspild",
    textfield1:
      "Du kan vise, at du går forrest i kampen mod madspild og bakker op om bevægelsen på dine sociale medier som Instagram, Facebook, Twitter o.lign. ved at bruge vores officielle hashtag #stopspildafmad",
    textfield2:
      "Har du en blog, hvor du laver lækker restemad eller er med til at stoppe madspild på en anden måde, så henvis til Stop Spild Af Mad - så vil du have mulighed for at din blog bliver eksponeret på vores facebookside, som tæller over 60.000 mennesker.",
    id: "spred-budskabet",
    link: "/tilmeldt",
    mediaType: "iframe",
    mediaSrc: "https://www.youtube.com/embed/2gyjbKHhltI?si=_Up3HWlv5518zdpx",
  },
];

// getStaticPaths - bygger en side for hver slug
export function getStaticPaths() {
  return [
    { params: { slug: "frivillig" } },
    { params: { slug: "stoettemedlem" } },
    { params: { slug: "samarbejdspartner" } },
    { params: { slug: "erhvervspartner" } },
    { params: { slug: "spred-budskabet" } },
  ];
}

// Hent slug fra URL
const { slug } = Astro.params;

// Find det matchende card
const item = cards.find((card) => card.slug === slug);
const media = item ? resolveMedia(item) : null;

// Changed: Get the color theme for this specific slug
// If slug not in map, default to green theme with all required properties (bg, accent, light, textColor)
// This ensures TypeScript knows all properties exist on the theme object
const currentTheme = slug ? colorThemeMap[slug] : { bg: "var(--color-green--400)", accent: "var(--color-green--200)", light: "var(--color-green--100)", textColor: "text-white" };

/* ========================================
   SEO: Dynamic description based on content
   ======================================== */
const pageDescription = item?.textfield1 || "Lær mere om hvordan du kan støtte Stop Spild Af Mad og være med til at gøre en forskel i kampen mod madspild.";
---

<MainLayout title={item?.title || "Indhold findes ikke"} description={pageDescription}>
  {!item ? (
    <div class="mr-section_right ml-section_left mt-section_top mb-section_buttom max-w-xl mx-auto">
      <div class="bg-yellow--100 radius-contentBox p-8 md:p-10 shadow-md text-center">
        <Heading htmlheading="h1" size="medium" stylingclasses="mb-4">
          Siden kunne ikke findes
        </Heading>
        <Text>Det indhold du leder efter findes ikke eller linket er forkert.</Text>
        <div class="mt-6">
          <Link href="/" variant="green">Tilbage til forsiden</Link>
        </div>
      </div>
    </div>
  ) : (
    <>
      <!-- ANIMATION: Hero section fades in on page load -->
      <div class="mr-section_right ml-section_left mt-section_top mb-8 grid gap-16 animate-fade-in">
        <Link href="/bliv_aktiv" variant="black" stylingclasses="inline-block">← Tilbage</Link>
        <Heading htmlheading="h1" size="large">{item.title}</Heading>
      </div>

      <!-- SEO & ANIMATION: Main content with dynamic background and fade-up animation -->
      <section style={`background-color: ${currentTheme.bg}`} class="intersect:animate-fade-up intersect-once">
        <div class="mr-section_right ml-section_left py-12 md:py-16 lg:py-20">
          <!-- Changed: Modified layout to handle varying content lengths professionally -->
          <!-- Removed lg:items-stretch and added lg:items-start for better vertical alignment -->
          <!-- Made media container sticky on desktop so video/image stays visible while scrolling text -->
          <div class="grid gap-8 lg:grid-cols-2 lg:gap-12 xl:gap-16 lg:items-start">
            {media && (
              <!-- Changed: Adjusted sticky positioning to lg:top-24 to ensure media never goes under the header -->
              <!-- Header height + spacing = approximately 6rem (96px), ensuring proper clearance -->
              <!-- Added shadow-xl and border for better visual depth and professional appearance -->
              <!-- Maintains full stacking behavior on mobile, side-by-side on desktop -->
              <div class="radius-contentBox overflow-hidden shadow-xl border-4 border-white/20 lg:sticky lg:top-24 lg:self-start">
                {media.type === "image" && (
                  <!-- SEO & PERFORMANCE: Alt-text and lazy loading for images -->
                  <img 
                    src={media.src} 
                    alt={item.title} 
                    class="w-full h-auto object-cover" 
                    width="800" 
                    height="600" 
                    loading="lazy"
                  />
                )}
                {media.type === "iframe" && (
                  <!-- Changed: Ensured iframe maintains 16:9 aspect ratio without distortion -->
                  <iframe src={media.src} title={item.title} class="w-full aspect-video border-0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen />
                )}
                {media.type === "video" && (
                  <!-- Changed: Video maintains aspect ratio properly -->
                  <video class="w-full h-auto object-cover" controls>
                    <source src={media.src} type="video/mp4" />
                  </video>
                )}
              </div>
            )}

            <!-- Changed: Cleaned up text content layout for more professional appearance -->
            <!-- Removed individual boxes for each text field, consolidated into single container -->
            <!-- Changed: Fixed Tailwind canonical class lg:min-h-[500px] → lg:min-h-125 -->
            <div class="space-y-6 lg:space-y-8 lg:min-h-125">
              <!-- Changed: Subtitle now uses dynamic accent color and text color from theme -->
              {item.subtitle && (
                <div class="border-l-4 pl-4 lg:pl-6" style={`border-color: ${currentTheme.accent}`}>
                  <Heading htmlheading="h2" size="medium" stylingclasses={currentTheme.textColor}>{item.subtitle}</Heading>
                </div>
              )}
              
              <!-- Changed: All text fields now have black text inside light background for readability -->
              <!-- Headers keep the theme color, but body text is always black -->
              <!-- Removed individual boxes for each text field, consolidated into single container -->
              {(item.textfield1 || item.textfield2 || item.textfield3) && (
                <div class="backdrop-blur-sm radius-contentBox p-5 lg:p-7 space-y-5" style={`background-color: ${currentTheme.light}`}>
                  {item.textfield1 && (
                    <div>
                      <Text stylingclasses="text-black leading-relaxed">{item.textfield1}</Text>
                    </div>
                  )}
                  
                  {item.textfield2 && (
                    <>
                      {item.textfield1 && <div class="my-4" style={`border-top: 1px solid ${currentTheme.accent}`}></div>}
                      <div>
                        <Text stylingclasses="text-black font-semibold leading-relaxed">{item.textfield2}</Text>
                      </div>
                    </>
                  )}
                  
                  {item.textfield3 && (
                    <>
                      {(item.textfield1 || item.textfield2) && <div class="my-4" style={`border-top: 1px solid ${currentTheme.accent}`}></div>}
                      <div>
                        <Text stylingclasses="text-black leading-relaxed">{item.textfield3}</Text>
                      </div>
                    </>
                  )}
                </div>
              )}

              <!-- Changed: Contact info box now uses dynamic accent colors and text color from theme -->
              {item.list && item.list.length > 0 && (
                <div class="backdrop-blur-md radius-contentBox p-6 lg:p-8 shadow-lg border-2" style={`background-color: rgb(255 255 255 / 0.15); border-color: ${currentTheme.accent}`}>
                  <Heading htmlheading="h3" size="xsmall" stylingclasses={`${currentTheme.textColor} mb-6`}>Kontaktinfo</Heading>
                  <ul class="space-y-3">
                    <!-- Changed: Bullet points now use dynamic accent color from theme -->
                    {item.list.map((li) => (
                      <li class="flex items-start gap-3">
                        <span class="text-lg mt-0.5" style={`color: ${currentTheme.accent}`}>●</span>
                        <Text stylingclasses={`${currentTheme.textColor} text-sm lg:text-base flex-1`}>{li}</Text>
                      </li>
                    ))}
                  </ul>
                </div>
              )}

              <!-- Changed: CTA button with cleaned up styling (removed unnecessary inline styles) -->
              {item.link && (
                <div class="pt-4 lg:pt-6">
                  <Link 
                    href={item.link} 
                    variant="green-inverted" 
                    size="large"
                    stylingclasses="inline-block transition-all duration-300 hover:scale-105"
                  >
                    Gå til Tilmelding →
                  </Link>
                </div>
              )}
            </div>
          </div>
        </div>
      </section>


   <section
    class="bg-white mr-section_right ml-section_left py-16 md:py-20 lg:py-24"
  >
    <Heading
      htmlheading="h2"
      size="large"
      stylingclasses="text-center mb-12 md:mb-16"
    >
      Hvad går din støtte til?
    </Heading>

    <div
      class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 md:gap-8 lg:gap-10"
    >
      <!-- Card 1 - Madspilds Manifest -->
      <article
        class="bg-white radius-contentBox border-2 border-gray-200 overflow-hidden flex flex-col shadow-md hover:shadow-2xl hover:border-green--400 transition-all duration-300 hover:-translate-y-1 intersect:animate-fade-up intersect-once group"
      >
        <div class="w-full p-8 pb-4 flex justify-center shrink-0">
          <img
            src="/img/stoettelogo1.webp"
            alt="Uddannelse logo"
            class="w-full max-w-40 h-auto object-contain"
          />
        </div>
        <div class="p-8 flex flex-col grow">
          <Heading
            htmlheading="h3"
            size="xsmall"
            font="sanstight"
            weight="semibold"
            stylingclasses="text-center mb-6"
          >
            Madspilds Manifest
          </Heading>

          <Text
            font="sans"
            weight="normal"
            stylingclasses="text-center mb-6 flex-grow text-sm md:text-base leading-relaxed text-gray-700"
          >
            Sammen med Coop Danmark har vi udarbejdet et Madspilds Manifest, og
            det lykkedes i perioden januar til september 2014 Coop Danmark at
            reducere madspild med 9,8% i deres butikker.
          </Text>

          <div class="mt-auto pt-4 flex justify-center">
            <Link href="/bliv_aktiv" variant="black" size="small">
              Læs mere
            </Link>
          </div>
        </div>
      </article>

      <!-- Card 2 - Øget Fokus -->
      <article
        class="bg-white radius-contentBox border-2 border-gray-200 overflow-hidden flex flex-col shadow-md hover:shadow-2xl hover:border-green--400 transition-all duration-300 hover:-translate-y-1 intersect:animate-fade-up intersect-once animate-delay-100 group"
      >
        <div class="w-full p-8 pb-4 flex justify-center shrink-0">
          <img
            src="/img/stoettelogo2.webp"
            alt="Uddannelse logo"
            class="w-full max-w-40 h-auto object-contain"
          />
        </div>
        <div class="p-8 flex flex-col grow">
          <Heading
            htmlheading="h3"
            size="xsmall"
            font="sanstight"
            weight="semibold"
            stylingclasses="text-center mb-6"
          >
            Øget Fokus
          </Heading>

          <Text
            font="sans"
            weight="normal"
            stylingclasses="text-center mb-6 flex-grow text-sm md:text-base leading-relaxed text-gray-700"
          >
            Vi har medvirket til at danskerne har øget sit fokus på at undgå
            madspild. Ifølge tal fra Landbrug & Fødevarer fra 2016 svarede 83%
            at de var blevet mere interesserede i at minimere husstandens
            madspild.
          </Text>

          <div class="mt-auto pt-4 flex justify-center">
            <Link href="/bliv_aktiv" variant="black" size="small">
              Læs mere
            </Link>
          </div>
        </div>
      </article>

      <!-- Card 3 - Mængderabatter -->
      <article
        class="bg-white radius-contentBox border-2 border-gray-200 overflow-hidden flex flex-col shadow-md hover:shadow-2xl hover:border-green--400 transition-all duration-300 hover:-translate-y-1 intersect:animate-fade-up intersect-once animate-delay-200 group"
      >
        <div class="w-full p-8 pb-4 flex justify-center shrink-0">
          <img
            src="/img/stoettelogo3.webp"
            alt="Uddannelse logo"
            class="w-full max-w-40 h-auto object-contain"
          />
        </div>
        <div class="p-8 flex flex-col grow">
          <Heading
            htmlheading="h3"
            size="xsmall"
            font="sanstight"
            weight="semibold"
            stylingclasses="text-center mb-6"
          >
            Mængderabatter
          </Heading>

          <Text
            font="sans"
            weight="normal"
            stylingclasses="text-center mb-6 flex-grow text-sm md:text-base leading-relaxed text-gray-700"
          >
            Stop Spild Af Mad har været medvirkende inspiration til at
            butikskæden REMA 1000 har droppet mængderabatter i kædens alle
            danske butikker og derved medvirker til mindre madspild.
          </Text>

          <div class="mt-auto pt-4 flex justify-center">
            <Link href="/bliv_aktiv" variant="black" size="small">
              Læs mere
            </Link>
          </div>
        </div>
      </article>
    </div>
  </section>

  <!-- Se Andre Støtteformer Section -->
  <section class="bg-yellow--100 py-16 md:py-20 lg:py-24">
    <div class="mr-section_right ml-section_left">
      <Heading
        htmlheading="h3"
        size="large"
        stylingclasses="text-center mb-12 md:mb-16"
      >
        Se andre støtteformer
      </Heading>
 <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
      <Card
        slug="frivillig"
        title="Bliv frivillig"
        image="/img/frivillig.webp"
        id="madlavning-workshops"
        link="/tilmeldt"
      />

      <Card
        slug="stoettemedlem"
        title="Bliv støttemedlem"
        image="/img/stoettemedlem.webp"
        id="frivillig-events"
        link="/tilmeldt"
      />

      <Card
        slug="samarbejdspartner"
        title="Bliv samarbejdspartner"
        image="/img/samarbejdspartner.webp"
        id="kokkekurser"
        link="/tilmeldt"
      />

      <Card
        slug="erhvervspartner"
        title="Bliv erhvervspartner"
        image="/img/erhvervspartner.webp"
        id="bekaempmadspild-maerkning"
        link="/tilmeldt"
      />

      <Card
        slug="spred-budskabet"
        title="Spred budskabet"
        image="/img/spred_budskab.webp"
        id="maddistribution"
        link="/tilmeldt"
      />
    </div>

    </div>
  </section>

  <!-- Contact Section -->
          <section class="mt-section_top mb-section_buttom">
          <div class="mr-section_right ml-section_left max-w-2xl mx-auto text-center lg:text-left">
            <Heading htmlheading="h4" size="large" stylingclasses="mb-6">
              Kontakt os
            </Heading>

            <Text stylingclasses="mb-8 text-base md:text-lg leading-relaxed text-gray-700">
              Er du i tvivl om noget eller vil du gerne vide mere? Skriv endelig
              til os!
            </Text>

            <Link
              href="mailto:info@stopspildafmad.org"
              variant="black"
              size="medium"
            >
              Send os en mail
            </Link>
          </div>
        </section>
      </>
    )
  }
</MainLayout>
